<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ChemMix Ultra Pro 5.0</title>
    <style>
        :root {
            --bg: #010409; --card: #0d1117; --border: #30363d;
            --accent: #58a6ff; --danger: #f85149; --warning: #d29922;
            --safe: #3fb950; --info: #bc8cff; --text: #c9d1d9;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: -apple-system, system-ui, "Segoe UI", Helvetica, Arial, sans-serif;
            background: var(--bg); color: var(--text); margin: 0; padding: 10px;
            font-size: 11px; line-height: 1.3;
        }
        h1 { font-size: 14px; text-align: center; color: var(--accent); margin: 0 0 10px 0; letter-spacing: 1px; }

        /* Contenedor Principal */
        .app-grid { display: flex; flex-direction: column; gap: 10px; max-width: 600px; margin: auto; }

        /* Estante de Qu√≠micos */
        .shelf-container {
            background: var(--card); border: 1px solid var(--border);
            border-radius: 8px; padding: 8px;
        }
        .shelf-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .shelf-title { font-weight: bold; font-size: 10px; color: var(--accent); text-transform: uppercase; }
        
        .chemical-list {
            display: grid; grid-template-columns: 1fr 1fr; gap: 5px;
            max-height: 250px; overflow-y: auto; padding-right: 5px;
        }
        /* Scrollbar est√©tica */
        .chemical-list::-webkit-scrollbar { width: 4px; }
        .chemical-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

        .chem-card {
            background: #161b22; border: 1px solid var(--border);
            padding: 6px 8px; border-radius: 6px; display: flex;
            align-items: center; justify-content: space-between;
            transition: 0.2s;
        }
        .chem-card.active { border-color: var(--accent); background: #1f2937; box-shadow: inset 0 0 5px rgba(88,166,255,0.2); }
        .chem-name { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80%; }
        
        /* Bot√≥n ? Estilizado */
        .q-btn {
            width: 18px; height: 18px; border-radius: 50%; border: 1px solid var(--info);
            background: none; color: var(--info); font-size: 10px; 
            display: flex; align-items: center; justify-content: center; cursor: pointer;
        }

        /* Zona de Mezcla */
        .reactor {
            background: var(--card); border: 1px dashed var(--border);
            border-radius: 12px; padding: 15px; text-align: center;
        }
        .selection-log { font-size: 10px; color: #8b949e; margin-bottom: 10px; min-height: 24px; }
        .mix-master-btn {
            width: 100%; padding: 12px; border: none; border-radius: 8px;
            background: var(--safe); color: white; font-weight: 800;
            font-size: 13px; text-transform: uppercase; box-shadow: 0 4px 0 #238636;
            transition: 0.1s;
        }
        .mix-master-btn:active { transform: translateY(3px); box-shadow: 0 1px 0 #238636; }
        .mix-master-btn:disabled { background: #21262d; color: #484f58; box-shadow: none; transform: none; }

        /* Resultados */
        .result-pane {
            display: none; background: #0d1117; border: 1px solid var(--border);
            border-radius: 8px; padding: 12px; animation: slideUp 0.3s ease-out;
            border-left: 4px solid var(--accent);
        }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .danger-tag { font-weight: bold; text-transform: uppercase; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-bottom: 5px; display: inline-block; }
        
        /* Libro de Recetas */
        .grimoire { background: #010409; border: 1px solid var(--border); border-radius: 8px; padding: 10px; }
        .recipe-list { margin-top: 8px; display: flex; flex-direction: column; gap: 4px; }
        .recipe-item { background: #161b22; padding: 6px; border-radius: 4px; border-left: 2px solid var(--safe); display: flex; justify-content: space-between; }

        /* Modales */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 9999;
        }
        .modal-content {
            background: var(--card); width: 90%; max-height: 85%;
            border-radius: 12px; border: 1px solid var(--accent); padding: 15px;
            overflow-y: auto; position: relative;
        }
        .close-x { position: absolute; top: 10px; right: 10px; color: var(--danger); font-weight: bold; font-size: 16px; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .info-cell { background: #161b22; padding: 8px; border-radius: 6px; border: 1px solid var(--border); }
        .risk-alert { background: rgba(248,81,73,0.15); border: 1px solid var(--danger); padding: 8px; border-radius: 6px; margin-top: 10px; }

        .btn-save { background: var(--accent); color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 10px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="app-grid">
    <h1>CHEMICAL LAB ULTRA PRO</h1>

    <div class="shelf-container">
        <div class="shelf-header">
            <span class="shelf-title">Inventario (50 Elementos)</span>
            <span id="count-display" style="font-size: 9px; opacity: 0.6;">0 seleccionados</span>
        </div>
        <div class="chemical-list" id="list"></div>
    </div>

    <div class="reactor">
        <div class="selection-log" id="selection-display">Esperando reactivos...</div>
        <button class="mix-master-btn" id="mix-btn" disabled onclick="handleMix()">Mezclar Reactivos</button>
        <div style="margin-top: 8px;">
            <button onclick="resetLab()" style="background:none; border:none; color:var(--danger); font-size:10px; cursor:pointer;">Vaciar Contenedores</button>
        </div>
    </div>

    <div id="result-box" class="result-pane"></div>

    <div class="grimoire">
        <span class="shelf-title">üìö Recetario de Seguridad</span>
        <div id="saved-recipes" class="recipe-list">
            <div style="font-size: 9px; opacity: 0.5;">No hay mezclas guardadas en memoria.</div>
        </div>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close-x" onclick="closeInfo()">√ó</span>
        <div id="modal-data"></div>
    </div>
</div>

<script>
    // --- BASE DE DATOS MASIVA (50 ELEMENTOS) ---
    const DB = {
        "√Åcido Sulf√∫rico": { tipo: "L√≠quido viscoso, incoloro", cont: "Vidrio/PEAD", color: "Transparente aceitoso", skin: "Carbonizaci√≥n inmediata", air: "Edema pulmonar", ingest: "Perforaci√≥n total", uso: "Bater√≠as/Industria", prev: "Protecci√≥n Clase A" },
        "Sodio Met√°lico": { tipo: "S√≥lido blando", cont: "Aceite Mineral", color: "Plateado/Blanco", skin: "Explosi√≥n t√©rmica", air: "Irritante", ingest: "Letal/Explosivo", uso: "S√≠ntesis", prev: "Ambiente inerte" },
        "√Åcido N√≠trico": { tipo: "L√≠quido humeante", cont: "Vidrio borosilicato", color: "Amarillento", skin: "Quemadura nitrante (amarilla)", air: "Gases NO2 (veneno)", ingest: "Mortal", uso: "Explosivos", prev: "Filtro vapores √°cidos" },
        "Glicerina": { tipo: "L√≠quido muy espeso", cont: "Pl√°stico/Vidrio", color: "Transparente", skin: "Seguro", air: "Inofensivo", ingest: "Laxante", uso: "Cosm√©tica/Alimentos", prev: "Lejos de oxidantes" },
        "Sosa C√°ustica": { tipo: "S√≥lido/Escamas", cont: "Pl√°stico reforzado", color: "Blanco", skin: "Saponificaci√≥n (disuelve grasa)", air: "Da√±a garganta", ingest: "Destrucci√≥n org√°nica", uso: "Limpieza", prev: "Gafas estancas" },
        "Permanganato K": { tipo: "Cristales finos", cont: "Vidrio oscuro", color: "P√∫rpura intenso", skin: "Tinte permanente", air: "Irritante", ingest: "T√≥xico", uso: "Purificaci√≥n", prev: "Sin contacto org√°nico" },
        "F√≥sforo Blanco": { tipo: "S√≥lido c√©reo", cont: "Agua (sumergido)", color: "Amarillento", skin: "Quemadura √≥sea persistente", air: "Humo letal", ingest: "Falla hep√°tica", uso: "Militar/Incendiario", prev: "No exponer al aire" },
        "Mercurio": { tipo: "Metal l√≠quido", cont: "Frasco irrompible", color: "Plateado espejo", skin: "Absorci√≥n lenta", air: "Vapores neurot√≥xicos", ingest: "Envenenamiento grave", uso: "Term√≥metros/Miner√≠a", prev: "Recipiente sellado" },
        "√Åcido Fluorh√≠drico": { tipo: "L√≠quido vol√°til", cont: "Pl√°stico (Disuelve vidrio)", color: "Incoloro", skin: "Ataca el calcio de los huesos", air: "Destruye pulmones", ingest: "Paro card√≠aco", uso: "Grabado de vidrio", prev: "Gel de gluconato de Ca" },
        "Cloro Gaseoso": { tipo: "Gas comprimido", cont: "Tanque acero", color: "Verde p√°lido", skin: "Irritaci√≥n/Ampollas", air: "Asfixia qu√≠mica", ingest: "N/A", uso: "Armas/Piscinas", prev: "M√°scara panor√°mica" },
        "Magnesio": { tipo: "Cinta/Polvo", cont: "Seco", color: "Gris met√°lico", skin: "Inerte", air: "Humo met√°lico", ingest: "N/A", uso: "Bengalas", prev: "Lejos de agua" },
        "Acetona": { tipo: "L√≠quido vol√°til", cont: "Vidrio/Metal", color: "Transparente", skin: "Desgrasante fuerte", air: "Narc√≥tico/Mareos", ingest: "T√≥xico", uso: "Disolvente", prev: "Antichispas" },
        "Per√≥xido 50%": { tipo: "L√≠quido denso", cont: "Venteado", color: "Azulado p√°lido", skin: "Necrosis blanca", air: "Irritante fuerte", ingest: "Embolia gaseosa", uso: "Cohetes", prev: "Fr√≠o/Oscuridad" },
        "Amon√≠aco Anhidro": { tipo: "Gas/L√≠quido", cont: "Presurizado", color: "Incoloro", skin: "Congelaci√≥n/Quemadura", air: "Espasmo bronquial", ingest: "Corrosivo", uso: "Fertilizantes", prev: "Traje encapsulado" },
        "Cianuro Potasio": { tipo: "Polvo cristalino", cont: "Caja fuerte", color: "Blanco", skin: "Absorci√≥n fatal", air: "Humo amargo", ingest: "Muerte instant√°nea", uso: "Joyas/Miner√≠a", prev: "Protocolo ant√≠doto" },
        "Litio Puro": { tipo: "Metal ultra ligero", cont: "Aceite", color: "Plateado", skin: "Quemadura c√°ustica", air: "Irritante", ingest: "Quemadura interna", uso: "Bater√≠as", prev: "Baja humedad" },
        "Azufre": { tipo: "Polvo/Piedra", cont: "Bolsa", color: "Amarillo lim√≥n", skin: "Dermatitis", air: "Asfixiante (quemado)", ingest: "Baja toxicidad", uso: "Polvora", prev: "Lejos de fuego" },
        "Salitre": { tipo: "Sal fina", cont: "Bolsa", color: "Blanco", skin: "Reseca", air: "Irrita", ingest: "Hipertensi√≥n", uso: "Conservas", prev: "Seco" },
        "Carb√≥n Activo": { tipo: "Polvo fino", cont: "Bolsa", color: "Negro mate", skin: "Ensucia", air: "Neumoconiosis", ingest: "Ant√≠doto", uso: "Filtros", prev: "Control de polvo" },
        "√Åcido Muri√°tico": { tipo: "L√≠quido", cont: "Pl√°stico", color: "Amarillo", skin: "Quemadura", air: "Humos", ingest: "Corrosivo", uso: "Obra", prev: "Gafas" },
        "Metanol": { tipo: "L√≠quido", cont: "Metal", color: "Incoloro", skin: "Absorci√≥n", air: "Ceguera", ingest: "Muerte/Ceguera", uso: "Combustible", prev: "Ventilado" },
        "Yodo": { tipo: "S√≥lido sublimable", cont: "Vidrio", color: "Violeta oscuro", skin: "Mancha", air: "Da√±a tiroides", ingest: "Grave", uso: "Antis√©ptico", prev: "Herm√©tico" },
        "Cal Viva": { tipo: "Piedra/Polvo", cont: "Saco", color: "Blanco", skin: "Deshidrataci√≥n", air: "Polvo", ingest: "Quemadura", uso: "Construcci√≥n", prev: "Lejos de agua" },
        "Etanol 96": { tipo: "L√≠quido", cont: "Pl√°stico", color: "Incoloro", skin: "Desinfecta", air: "Embriaga", ingest: "Embriaga", uso: "Salud", prev: "Inflamable" },
        "Cloroformo": { tipo: "L√≠quido pesado", cont: "Ambar Vidrio", color: "Incoloro", skin: "Irrita", air: "Anest√©sico/Muerte", ingest: "Fallo hep√°tico", uso: "Laboratorio", prev: "Fr√≠o" },
        "Benceno": { tipo: "L√≠quido", cont: "Metal", color: "Incoloro", skin: "Cancer√≠geno", air: "Leucemia", ingest: "Fatal", uso: "Qu√≠mica", prev: "No respirar" },
        "Tolueno": { tipo: "L√≠quido", cont: "Metal", color: "Incoloro", skin: "Irrita", air: "Alucin√≥geno", ingest: "Grave", uso: "Pegamentos", prev: "Extracci√≥n" },
        "Formaldeh√≠do": { tipo: "Gas/L√≠quido", cont: "Vidrio", color: "Incoloro", skin: "Endurece", air: "C√°ncer", ingest: "Momificaci√≥n", uso: "Preservaci√≥n", prev: "Herm√©tico" },
        "Bicarbonato": { tipo: "Polvo", cont: "Bolsa", color: "Blanco", skin: "Nulo", air: "Nulo", ingest: "Anti√°cido", uso: "Cocina", prev: "N/A" },
        "Vinagre": { tipo: "L√≠quido", cont: "Pl√°stico", color: "Transparente", skin: "Nulo", air: "Olor", ingest: "Seguro", uso: "Cocina", prev: "N/A" },
        "Lavandina": { tipo: "L√≠quido", cont: "Pl√°stico", color: "Verdoso", skin: "Irrita", air: "Tos", ingest: "Grave", uso: "Limpieza", prev: "No mezclar" },
        "Aguarr√°s": { tipo: "L√≠quido", cont: "Metal", color: "Incoloro", skin: "Dermatitis", air: "Mareo", ingest: "Grave", uso: "Pintura", prev: "Ventilaci√≥n" },
        "√Åcido Ox√°lico": { tipo: "Cristales", cont: "Pl√°stico", color: "Blanco", skin: "Irrita", air: "Da√±a ri√±√≥n", ingest: "Piedras ri√±√≥n", uso: "Madera", prev: "Guantes" },
        "Borax": { tipo: "Polvo", cont: "Bolsa", color: "Blanco", skin: "Leve", air: "Irrita", ingest: "V√≥mito", uso: "Slime/Soldar", prev: "N/A" },
        "Plomo": { tipo: "Metal pesado", cont: "Cualquiera", color: "Gris", skin: "Seguro", air: "Plumbosis", ingest: "Saturnismo", uso: "Pesas", prev: "Lavarse manos" },
        "√Åcido C√≠trico": { tipo: "Polvo", cont: "Pl√°stico", color: "Blanco", skin: "Irrita", air: "Estornudo", ingest: "Agrio", uso: "Conservante", prev: "N/A" },
        "Nitrocelulosa": { tipo: "Algod√≥n/L√°mina", cont: "Agua (h√∫medo)", color: "Blanco", skin: "Nulo", air: "Nulo", ingest: "N/A", uso: "Cine/Magia", prev: "No secar" },
        "√âter Et√≠lico": { tipo: "L√≠quido vol√°til", cont: "Vidrio oscuro", color: "Incoloro", skin: "Fr√≠o", air: "Anestesia", ingest: "Fatal", uso: "Cirug√≠a", prev: "Explosivo" },
        "F√≥sforo Rojo": { tipo: "Polvo", cont: "Frasco", color: "Rojizo", skin: "Seguro", air: "T√≥xico", ingest: "Grave", uso: "Cerillas", prev: "Lejos de fuego" },
        "Calcio Puro": { tipo: "Metal", cont: "Arg√≥n", color: "Gris", skin: "C√°ustico", air: "Irrita", ingest: "Quemadura", uso: "Aleaci√≥n", prev: "Seco" },
        "√Åcido Tart√°rico": { tipo: "Polvo", cont: "Bolsa", color: "Blanco", skin: "Nulo", air: "Nulo", ingest: "Uvas", uso: "Vino", prev: "N/A" },
        "Hidr√≥xido Bario": { tipo: "Polvo", cont: "Frasco", color: "Blanco", skin: "C√°ustico", air: "Venenoso", ingest: "Par√°lisis", uso: "Lab", prev: "Guantes" },
        "Nitr√≥geno Liq.": { tipo: "L√≠quido crio", cont: "Dewar", color: "Incoloro", skin: "Congelaci√≥n -196C", air: "Asfixia", ingest: "Explosi√≥n g√°strica", uso: "Verrugas", prev: "Guantes crios" },
        "Hierro (Polvo)": { tipo: "Polvo", cont: "Im√°n/Seco", color: "Negro", skin: "Seguro", air: "Siderosis", ingest: "N/A", uso: "Imanes", prev: "N/A" },
        "Permanganato Na": { tipo: "L√≠quido", cont: "Vidrio", color: "Rojo oscuro", skin: "Mancha", air: "Irrita", ingest: "T√≥xico", uso: "Oxidante", prev: "Peligroso" },
        "√Åcido Cr√≥mico": { tipo: "L√≠quido", cont: "Vidrio", color: "Rojo sangre", skin: "√ölceras de cromo", air: "C√°ncer nasal", ingest: "Mortal", uso: "Cromado", prev: "Traje completo" },
        "Butilo": { tipo: "Gas", cont: "Tanque", color: "Incoloro", skin: "Congela", air: "Asfixia", ingest: "N/A", uso: "Encendedores", prev: "No chispas" },
        "Trementina": { tipo: "L√≠quido", cont: "Lata", color: "Amarillo", skin: "Alergia", air: "Asma", ingest: "Grave", uso: "Arte", prev: "Natural" },
        "Grafito": { tipo: "S√≥lido/Polvo", cont: "Caja", color: "Gris oscuro", skin: "Ensucia", air: "Pulm√≥n", ingest: "Seguro", uso: "L√°piz", prev: "Conductivo" },
        "Hielo Seco": { tipo: "S√≥lido -78C", cont: "Nevera", color: "Blanco", skin: "Quemadura fr√≠o", air: "Asfixia CO2", ingest: "Mortal", uso: "Efectos", prev: "No cerrar herm√©tico" }
    };

    // --- MOTOR DE REACCIONES (L√≥gica Pro) ---
    const REACTIONS = [
        { items: ["Lavandina", "Amon√≠aco Anhidro"], name: "Gas Cloramina", danger: "CR√çTICO üî¥", desc: "Nube t√≥xica mortal que causa edema pulmonar inmediato.", prot: "Evacuaci√≥n con m√°scara de aire aut√≥nomo." },
        { items: ["√Åcido Sulf√∫rico", "Azufre", "Salitre"], name: "P√≥lvora √Åcida", danger: "EXPLOSIVO üî•", desc: "Combusti√≥n violenta con liberaci√≥n de vapores de nitr√≥geno.", prot: "Manejo remoto detr√°s de blindaje." },
        { items: ["Glicerina", "Permanganato K"], name: "Ignici√≥n Qu√≠mica", danger: "FUEGO ‚ö°", desc: "Fuego espont√°neo de alta temperatura tras 15 segundos.", prot: "Realizar en crisol cer√°mico." },
        { items: ["√Åcido Fluorh√≠drico", "Lavandina"], name: "Gas Fl√∫or/Cloro", danger: "LETAL ‚ò£Ô∏è", desc: "Mezcla gaseosa que disuelve el tejido vivo al contacto.", prot: "Prohibido fuera de bunkers qu√≠micos." },
        { items: ["Sodio Met√°lico", "√Åcido Muri√°tico"], name: "Sal + Hidr√≥geno", danger: "EXPLOSI√ìN üß®", desc: "Reacci√≥n exot√©rmica masiva que lanza √°cido hirviendo.", prot: "No intentar bajo ninguna circunstancia." },
        { items: ["Acetona", "Per√≥xido 50%"], name: "TATP (Explosivo)", danger: "MORTAL üí£", desc: "Cristales ultra-sensibles que detonan por el tacto.", prot: "Prohibido. Inestable a temperatura ambiente." },
        { items: ["√Åcido N√≠trico", "Glicerina"], name: "Nitroglicerina", danger: "CATASTR√ìFICO üíÄ", desc: "L√≠quido explosivo primario. Destruye el edificio.", prot: "Solo en instalaciones militares criog√©nicas." },
        { items: ["Sosa C√°ustica", "Hierro (Polvo)"], name: "Corrosi√≥n Acelerada", danger: "CALOR üü†", desc: "Ataque qu√≠mico con liberaci√≥n de calor moderado.", prot: "Guantes de protecci√≥n t√©rmica." },
        { items: ["√Åcido Sulf√∫rico", "Per√≥xido 50%"], name: "Soluci√≥n Pira√±a", danger: "EXTREMO üî¥", desc: "L√≠quido que vaporiza cualquier materia org√°nica al contacto.", prot: "Traje completo resistente a √°cidos." },
        { items: ["Nitr√≥geno Liq.", "Vinagre"], name: "Hielo de √Åcido", danger: "FR√çO ‚ùÑÔ∏è", desc: "Solidificaci√≥n instant√°nea. Proyectiles de hielo √°cido.", prot: "Protecci√≥n facial criog√©nica." },
        { items: ["Cloroformo", "Acetona"], name: "Reacci√≥n Exot√©rmica", danger: "PELIGRO ‚ò¢Ô∏è", desc: "Puede causar una ebullici√≥n violenta y gases narc√≥ticos.", prot: "Campana de extracci√≥n obligatoria." },
        { items: ["Mercurio", "Aluminio"], name: "Amalgama de Al", danger: "CORROSI√ìN ‚ö†Ô∏è", desc: "El mercurio destruye la capa de √≥xido del aluminio, 'comi√©ndoselo'.", prot: "No acercar mercurio a aviones." }
    ];

    let currentSelected = [];
    let saved = JSON.parse(localStorage.getItem('chem_lab_v5')) || [];

    // --- FUNCIONES CORE ---

    function init() {
        const container = document.getElementById('list');
        const sortedKeys = Object.keys(DB).sort();
        
        sortedKeys.forEach(name => {
            const card = document.createElement('div');
            card.className = 'chem-card';
            card.id = `chem-${name}`;
            card.innerHTML = `
                <span class="chem-name">${name}</span>
                <button class="q-btn" onclick="openInfo(event, '${name}')">?</button>
            `;
            card.onclick = () => toggleChem(name);
            container.appendChild(card);
        });
        updateSavedUI();
    }

    function toggleChem(name) {
        const el = document.getElementById(`chem-${name}`);
        if (currentSelected.includes(name)) {
            currentSelected = currentSelected.filter(n => n !== name);
            el.classList.remove('active');
        } else {
            if (currentSelected.length >= 5) { alert("M√°ximo 5 reactivos!"); return; }
            currentSelected.push(name);
            el.classList.add('active');
        }
        updateUI();
    }

    function updateUI() {
        document.getElementById('count-display').innerText = `${currentSelected.length} seleccionados`;
        document.getElementById('selection-display').innerText = currentSelected.length > 0 ? currentSelected.join(' + ') : "Esperando reactivos...";
        document.getElementById('mix-btn').disabled = currentSelected.length < 2;
    }

    function openInfo(e, name) {
        e.stopPropagation();
        const data = DB[name];
        const modal = document.getElementById('modal');
        const content = document.getElementById('modal-data');
        
        content.innerHTML = `
            <h2 style="margin:0; color:var(--accent); font-size:16px;">${name}</h2>
            <div class="info-grid">
                <div class="info-cell"><b>Estado:</b><br>${data.tipo}</div>
                <div class="info-cell"><b>Envase:</b><br>${data.cont}</div>
                <div class="info-cell"><b>Color:</b><br>${data.color}</div>
                <div class="info-cell"><b>Uso:</b><br>${data.uso}</div>
            </div>
            <div class="risk-alert">
                <h4 style="margin:0; color:var(--danger); font-size:10px;">‚ò£Ô∏è PROTOCOLO DE EXPOSICI√ìN</h4>
                <p>üñêÔ∏è <b>Piel:</b> ${data.skin}</p>
                <p>üå¨Ô∏è <b>Respirar:</b> ${data.air}</p>
                <p>üëÑ <b>Tragar:</b> ${data.ingest}</p>
            </div>
            <p style="margin-top:10px;">üõ°Ô∏è <b>Prevenci√≥n:</b> ${data.prev}</p>
        `;
        modal.style.display = 'flex';
    }

    function closeInfo() { document.getElementById('modal').style.display = 'none'; }

    function handleMix() {
        const box = document.getElementById('result-box');
        const match = REACTIONS.find(r => 
            r.items.length === currentSelected.length && 
            r.items.every(i => currentSelected.includes(i))
        );

        box.style.display = "block";
        if (match) {
            box.style.borderLeftColor = "var(--danger)";
            box.innerHTML = `
                <div class="danger-tag" style="background:var(--danger); color:white">${match.danger}</div>
                <h3 style="margin:5px 0; color:white">${match.name}</h3>
                <p>${match.desc}</p>
                <p style="color:var(--warning)"><b>üí° PROTOCOLO:</b> ${match.prot}</p>
                <button class="btn-save" onclick="saveRecipe('${match.name}', '${currentSelected.join(' + ')}')">üíæ Guardar Receta</button>
            `;
        } else {
            box.style.borderLeftColor = "#555";
            box.innerHTML = `
                <div class="danger-tag" style="background:#555; color:white">DESCONOCIDO</div>
                <h3 style="margin:5px 0;">Mezcla No Catalogada</h3>
                <p>La combinaci√≥n puede ser inerte o extremadamente inestable. No existen registros de seguridad.</p>
            `;
        }
        window.scrollTo(0, document.body.scrollHeight);
    }

    function saveRecipe(name, combo) {
        if (!saved.some(r => r.combo === combo)) {
            saved.push({ name, combo });
            localStorage.setItem('chem_lab_v5', JSON.stringify(saved));
            updateSavedUI();
            alert("Receta archivada.");
        }
    }

    function updateSavedUI() {
        const list = document.getElementById('saved-recipes');
        if (saved.length === 0) return;
        list.innerHTML = saved.map(r => `
            <div class="recipe-item">
                <div><b>${r.name}</b><br><small>${r.combo}</small></div>
            </div>
        `).join('');
    }

    function resetLab() {
        currentSelected = [];
        document.querySelectorAll('.chem-card').forEach(c => c.classList.remove('active'));
        document.getElementById('result-box').style.display = 'none';
        updateUI();
    }

    init();
</script>
</body>
</html>
