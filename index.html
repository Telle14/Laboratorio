<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lab Master V10 - Evolution</title>
    <style>
        :root {
            --bg: #010409; --card: #0d1117; --border: #30363d;
            --accent: #58a6ff; --danger: #f85149; --warning: #d29922;
            --safe: #3fb950; --info: #bc8cff; --text: #c9d1d9;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 10px; font-size: 11px; }
        
        .container { max-width: 600px; margin: auto; display: flex; flex-direction: column; gap: 8px; }
        h1 { font-size: 16px; text-align: center; color: var(--accent); margin: 5px 0; letter-spacing: 2px; }

        .search-box { position: sticky; top: 0; z-index: 100; background: var(--bg); padding: 5px 0; }
        #search { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: white; font-size: 13px; }

        .shelf { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 8px; max-height: 350px; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .item { background: #161b22; border: 1px solid var(--border); padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; position: relative;}
        .item.active { border-color: var(--accent); background: #1f2937; box-shadow: 0 0 10px rgba(88,166,255,0.2); }
        .item.hide { display: none; }
        .item.new-item { border-color: var(--safe); background: #0e2a14; }

        .q-btn { width: 22px; height: 22px; border-radius: 50%; border: 1px solid var(--info); color: var(--info); background: none; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; }

        .reactor { background: var(--card); border: 2px dashed var(--border); border-radius: 12px; padding: 15px; text-align: center; }
        .mix-btn { width: 100%; padding: 14px; border-radius: 8px; border: none; background: var(--safe); color: white; font-weight: bold; font-size: 14px; cursor: pointer; }
        .mix-btn:disabled { background: #21262d; color: #484f58; }

        .result-pane { display: none; background: #161b22; border: 1px solid var(--border); border-radius: 8px; padding: 15px; margin-top: 8px; border-left: 5px solid var(--accent); position: relative; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-content { background: var(--card); border: 1px solid var(--accent); border-radius: 15px; padding: 20px; width: 100%; max-height: 85%; overflow-y: auto; }
        .close-btn { background: var(--danger); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; margin-top: 15px; font-weight: bold; }
        
        .danger-badge { font-size: 10px; font-weight: bold; padding: 2px 8px; border-radius: 4px; display: inline-block; margin-bottom: 8px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üî¨ LAB MASTER V10 EVOLUTION</h1>

    <div class="search-box">
        <input type="text" id="search" placeholder="Buscar elemento o receta..." onkeyup="filter()">
    </div>

    <div class="shelf">
        <div class="grid" id="inventory"></div>
    </div>

    <div class="reactor">
        <div id="selection-text" style="margin-bottom: 8px; color: #8b949e; font-size: 10px;">Reactivos listos: Ninguno</div>
        <button class="mix-btn" id="mix-trigger" disabled onclick="simulate()">MEZCLAR REACTIVOS</button>
        <button onclick="clearLab()" style="background:none; border:none; color:var(--danger); font-size:9px; margin-top:10px; cursor:pointer;">LIMPIAR MESA</button>
    </div>

    <div id="result-display" class="result-pane"></div>
</div>

<div id="modal" class="modal">
    <div class="modal-content" id="modal-body"></div>
</div>

<script>
    // BASE DE DATOS MASIVA RECUPERADA
    const QUIMICOS = {
        "Acido Fluorhidrico": { d: "L√≠quido incoloro ultra-corrosivo.", piel: "Destruye el calcio de los huesos por dentro.", aire: "Asfixia inmediata, da√±o pulmonar grave.", ingest: "Mortal.", prev: "Uso de guantes de nitrilo grueso y m√°scara.", uso: "Grabar vidrio y chips." },
        "Hierro": { d: "Metal de transici√≥n s√≥lido.", piel: "Seguro.", aire: "Nulo.", ingest: "Grave en grandes cantidades.", prev: "N/A", uso: "Estructuras y herramientas." },
        "Agua": { d: "Solvente universal (H2O).", piel: "Seguro.", aire: "Seguro.", ingest: "Vital.", prev: "N/A", uso: "Vida y enfriamiento." },
        "Fuego": { d: "Plasma y energ√≠a t√©rmica.", piel: "Quemaduras de 1er a 3er grado.", aire: "Mon√≥xido de carbono (t√≥xico).", ingest: "Mortal.", prev: "Manejar en campana.", uso: "Catalizador de calor." },
        "Sodio Metalico": { d: "Metal blando plateado ultra reactivo.", piel: "Corrosivo, quema al contacto con humedad.", aire: "Irritante.", ingest: "Explosivo en el est√≥mago.", prev: "Guardar en aceite mineral.", uso: "Laboratorio avanzado." },
        "Litio": { d: "Metal ligero y reactivo.", piel: "Irrita y quema con humedad.", aire: "Da√±a v√≠as respiratorias.", ingest: "T√≥xico/Grave.", prev: "Evitar contacto con agua.", uso: "Bater√≠as." },
        "Salitre": { d: "Nitrato de potasio (Oxidante).", piel: "Reseca la piel.", aire: "Nulo.", ingest: "Grave.", prev: "Mantener seco.", uso: "Conservante y p√≥lvora." },
        "Azufre": { d: "No metal amarillento inflamable.", piel: "Leve irritaci√≥n.", aire: "Di√≥xido de azufre al quemarse (asfixia).", ingest: "T√≥xico.", prev: "Lejos de fuego.", uso: "Vulcanizaci√≥n." },
        "Carbon": { d: "Elemento base de la vida.", piel: "Suciedad.", aire: "Polvo da√±a pulmones.", ingest: "Ant√≠doto (carb√≥n activado).", prev: "N/A", uso: "Combustible." },
        "Lavandina": { d: "Hipoclorito de sodio.", piel: "Corrosivo e irritante.", aire: "Irrita ojos y nariz.", ingest: "Quemadura interna.", prev: "No mezclar con √°cidos.", uso: "Desinfecci√≥n." },
        "Amoniaco": { d: "Gas/l√≠quido de olor penetrante.", piel: "Quema los tejidos.", aire: "Letal en altas concentraciones.", ingest: "Corrosivo.", prev: "Usar en lugar ventilado.", uso: "Limpieza y agro." },
        "Glicerina": { d: "L√≠quido viscoso incoloro.", piel: "Seguro (hidratante).", aire: "Nulo.", ingest: "Seguro.", prev: "N/A", uso: "Jabones y cosm√©ticos." },
        "Permanganato de Potasio": { d: "Sal cristalina p√∫rpura.", piel: "Mancha la piel permanentemente.", aire: "Irrita.", ingest: "Venenoso.", prev: "Usar guantes.", uso: "Desinfecci√≥n de aguas." }
    };

    const REACCIONES = [
        { items: ["Salitre", "Azufre", "Carbon"], nombre: "Polvora Negra", peligro: "ALTO", color: "var(--warning)", desc: "Se ha sintetizado P√≥lvora. Un compuesto s√≥lido capaz de deflagrar.", extra: "Al mezclar estos tres ingredientes, el salitre aporta el ox√≠geno para que el carb√≥n y el azufre ardan instant√°neamente.", util: true },
        { items: ["Polvora Negra", "Fuego"], nombre: "Explosion Pirotecnica", peligro: "MORTAL", color: "var(--danger)", desc: "¬°KABOOM! La p√≥lvora se expande en una bola de fuego.", extra: "La energ√≠a qu√≠mica se libera en milisegundos creando una onda de presi√≥n.", util: false },
        { items: ["Litio", "Agua"], nombre: "Estallido de Hidrogeno", peligro: "EXTREMO", color: "var(--danger)", desc: "El litio reacciona creando gas hidr√≥geno que se inflama.", extra: "Es una reacci√≥n exot√©rmica violenta t√≠pica de los metales alcalinos.", util: false },
        { items: ["Lavandina", "Amoniaco"], nombre: "Gas Cloramina", peligro: "MORTAL", color: "var(--danger)", desc: "Humo blanco invisible y letal.", extra: "Ataca las membranas mucosas y causa edema pulmonar inmediato.", util: false },
        { items: ["Acido Fluorhidrico", "Hierro"], nombre: "Desecho Corrosivo", peligro: "BAJO", color: "#444", desc: "El hierro se desintegra en una masa negra.", extra: "No sirve para nada, es solo residuo qu√≠mico.", util: false },
        { items: ["Glicerina", "Permanganato de Potasio"], nombre: "Ignicion Espontanea", peligro: "ALTO", color: "var(--warning)", desc: "Fuego p√∫rpura tras unos segundos de retraso.", extra: "Oxidaci√≥n extrema de la glicerina.", util: false }
    ];

    let seleccionados = [];
    let inventarioPersonal = JSON.parse(localStorage.getItem('lab_inv_v10')) || [];

    function setup() {
        renderInventory();
    }

    function renderInventory() {
        const inv = document.getElementById('inventory');
        inv.innerHTML = "";
        
        // Elementos base
        const base = Object.keys(QUIMICOS).sort();
        base.forEach(n => createItem(n, false));

        // Elementos creados (P√≥lvora, etc)
        inventarioPersonal.forEach(n => createItem(n, true));
    }

    function createItem(n, isNew) {
        const inv = document.getElementById('inventory');
        const d = document.createElement('div');
        d.className = `item ${isNew ? 'new-item' : ''}`;
        d.id = `item-${n.replace(/ /g, "_")}`;
        
        // Info espec√≠fica si es nuevo o base
        const data = QUIMICOS[n] || { d: "Producto sintetizado en este laboratorio.", uso: "Reactivo complejo." };

        d.innerHTML = `<span>${n}</span> <button class="q-btn" onclick="openInfo(event, '${n}')">?</button>`;
        d.onclick = () => toggle(n, d);
        inv.appendChild(d);
    }

    function toggle(n, el) {
        if (seleccionados.includes(n)) {
            seleccionados = seleccionados.filter(x => x !== n);
            el.classList.remove('active');
        } else {
            if (seleccionados.length >= 3) return;
            seleccionados.push(n);
            el.classList.add('active');
        }
        document.getElementById('selection-text').innerText = seleccionados.length ? "Reactivos: " + seleccionados.join(' + ') : "Reactivos listos: Ninguno";
        document.getElementById('mix-trigger').disabled = seleccionados.length < 2;
    }

    function simulate() {
        const box = document.getElementById('result-display');
        const match = REACCIONES.find(r => r.items.length === seleccionados.length && r.items.every(i => seleccionados.includes(i)));
        
        box.style.display = "block";
        if (match) {
            box.style.borderLeftColor = match.color;
            box.innerHTML = `
                <div class="danger-badge" style="background:${match.color}; color:white">PELIGRO: ${match.peligro}</div>
                <h3 style="margin:0">${match.nombre}</h3>
                <p>${match.desc}</p>
                <button class="q-btn" style="position:absolute; top:15px; right:15px" onclick="openReactionInfo('${match.nombre}')">?</button>
                ${match.util && !inventarioPersonal.includes(match.nombre) ? `<button onclick="craftItem('${match.nombre}')" style="width:100%; padding:10px; background:var(--safe); border:none; color:white; border-radius:5px; font-weight:bold; margin-top:10px;">A√ëADIR A ESTANTE</button>` : ""}
            `;
        } else {
            box.innerHTML = `<h3>Resultado Desconocido</h3><p>La mezcla no produjo una reacci√≥n registrada.</p>`;
        }
    }

    function craftItem(nombre) {
        if (!inventarioPersonal.includes(nombre)) {
            inventarioPersonal.push(nombre);
            localStorage.setItem('lab_inv_v10', JSON.stringify(inventarioPersonal));
            renderInventory();
            document.getElementById('result-display').style.display = "none";
            clearLab();
        }
    }

    function openInfo(e, n) {
        e.stopPropagation();
        const d = QUIMICOS[n] || { d: "Producto sintetizado.", uso: "Reactivo complejo.", piel: "Desconocido", aire: "Desconocido", ingest: "Desconocido", prev: "Manejar con cuidado." };
        document.getElementById('modal-body').innerHTML = `
            <h2 style="color:var(--accent); margin-top:0">${n}</h2>
            <p>${d.d}</p>
            <div style="background:#161b22; padding:15px; border-radius:10px; text-align:left">
                <p>‚ö†Ô∏è <b>Piel:</b> ${d.piel}</p>
                <p>üå¨Ô∏è <b>Aire:</b> ${d.aire}</p>
                <p>üëÑ <b>Ingesti√≥n:</b> ${d.ingest}</p>
                <p>üõ°Ô∏è <b>Prevenci√≥n:</b> ${d.prev}</p>
            </div>
            <p>üõ†Ô∏è <b>Uso:</b> ${d.uso}</p>
            <button class="close-btn" onclick="closeM()">CERRAR FICHA</button>
        `;
        document.getElementById('modal').style.display = 'flex';
    }

    function openReactionInfo(nombre) {
        const r = REACCIONES.find(x => x.nombre === nombre);
        document.getElementById('modal-body').innerHTML = `
            <h3>EXPLICACI√ìN CIENT√çFICA</h3>
            <h2 style="color:var(--warning)">${r.nombre}</h2>
            <p style="font-size:13px; line-height:1.5">${r.extra}</p>
            <p><b>Reactivos usados:</b> ${r.items.join(' + ')}</p>
            <button class="close-btn" onclick="closeM()">ENTENDIDO</button>
        `;
        document.getElementById('modal').style.display = 'flex';
    }

    function closeM() { document.getElementById('modal').style.display = 'none'; }

    function clearLab() {
        seleccionados = [];
        document.querySelectorAll('.item').forEach(i => i.classList.remove('active'));
        document.getElementById('result-display').style.display = "none";
        document.getElementById('mix-trigger').disabled = true;
        document.getElementById('selection-text').innerText = "Reactivos listos: Ninguno";
    }

    function filter() {
        const q = document.getElementById('search').value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        document.querySelectorAll('.item').forEach(el => {
            el.classList.toggle('hide', !el.innerText.toLowerCase().includes(q));
        });
    }

    setup();
</script>
</body>
</html>
