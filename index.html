<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lab Master V8 - Crafting Edition</title>
    <style>
        :root {
            --bg: #010409; --card: #0d1117; --border: #30363d;
            --accent: #58a6ff; --danger: #f85149; --warning: #d29922;
            --safe: #3fb950; --info: #bc8cff; --text: #c9d1d9;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 10px; font-size: 11px; overflow-x: hidden; }
        
        .container { max-width: 600px; margin: auto; display: flex; flex-direction: column; gap: 8px; }
        h1 { font-size: 16px; text-align: center; color: var(--accent); margin: 5px 0; text-transform: uppercase; letter-spacing: 2px; }

        .search-box { position: sticky; top: 0; z-index: 100; background: var(--bg); padding: 5px 0; }
        #search { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: white; font-size: 13px; }

        .shelf { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 8px; max-height: 250px; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .item { background: #161b22; border: 1px solid var(--border); padding: 8px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .item.active { border-color: var(--accent); background: #1f2937; }
        .item.hide { display: none; }

        .q-btn { width: 18px; height: 18px; border-radius: 50%; border: 1px solid var(--info); color: var(--info); background: none; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 10px; cursor: help; }

        .reactor { background: var(--card); border: 2px dashed var(--border); border-radius: 12px; padding: 15px; text-align: center; }
        .mix-btn { width: 100%; padding: 12px; border-radius: 8px; border: none; background: var(--safe); color: white; font-weight: bold; font-size: 13px; cursor: pointer; }
        .mix-btn:disabled { background: #21262d; color: #484f58; }

        .result-pane { display: none; background: #161b22; border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-top: 8px; border-left: 4px solid var(--accent); animation: slide 0.3s ease; }
        @keyframes slide { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .history { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 10px; }
        .recipe-card { background: #010409; border-radius: 6px; padding: 8px; margin-bottom: 5px; border-left: 3px solid var(--safe); }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-content { background: var(--card); border: 1px solid var(--accent); border-radius: 12px; padding: 20px; width: 100%; max-height: 80%; overflow-y: auto; }
        .close-btn { background: var(--danger); color: white; border: none; padding: 10px; border-radius: 6px; width: 100%; margin-top: 10px; font-weight: bold; }

        .danger-tag { font-weight: bold; font-size: 9px; padding: 2px 6px; border-radius: 4px; margin-bottom: 5px; display: inline-block; }
    </style>
</head>
<body>

<div class="container">
    <h1>CHEM-LAB Master V8</h1>

    <div class="search-box">
        <input type="text" id="search" placeholder="Buscar reactivo..." onkeyup="filter()">
    </div>

    <div class="shelf">
        <div class="grid" id="inventory"></div>
    </div>

    <div class="reactor">
        <div id="selection-text" style="margin-bottom: 8px; color: #8b949e; font-size: 10px;">Selecciona elementos para combinar...</div>
        <button class="mix-btn" id="mix-trigger" disabled onclick="simulate()">MEZCLAR AHORA</button>
        <button onclick="clearLab()" style="background:none; border:none; color:var(--danger); font-size:9px; margin-top:10px; cursor:pointer;">RESETEAR MESA</button>
    </div>

    <div id="result-display" class="result-pane"></div>

    <div class="history">
        <span style="font-weight:bold; color:var(--accent); font-size:10px;">üìî BIT√ÅCORA DE DESCUBRIMIENTOS</span>
        <div id="saved-list" style="margin-top:8px;"></div>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-content" id="modal-body"></div>
</div>

<script>
    const QUIMICOS = {
        "Acido Fluorhidrico": { desc: "Liquido ultra-corrosivo.", piel: "Da√±a huesos.", uso: "Grabado de cristales." },
        "Hierro": { desc: "Metal de transicion.", piel: "Seguro.", uso: "Construccion pesada." },
        "Agua": { desc: "Solvente universal.", piel: "Seguro.", uso: "Refrigerante y vida." },
        "Fuego": { desc: "Energia termica.", piel: "Quema.", uso: "Iniciador de reacciones." },
        "Sodio Metalico": { desc: "Metal altamente reactivo.", piel: "Corrosivo.", uso: "Sintesis organica." },
        "Litio": { desc: "Metal ligero reactivo.", piel: "Irrita.", uso: "Baterias de alto rendimiento." },
        "Salitre": { desc: "Oxidante potente (Nitrato).", piel: "Reseca.", uso: "Fertilizantes y polvora." },
        "Azufre": { desc: "No metal inflamable.", piel: "Leve irritacion.", uso: "Vulcanizacion." },
        "Carbon": { desc: "Elemento base organico.", piel: "Mancha.", uso: "Combustible y filtros." },
        "Polvora": { desc: "Mezcla explosiva artesanal.", piel: "Seguro (sin fuego).", uso: "Mineria y pirotecnia." },
        "Lavandina": { desc: "Desinfectante clorado.", piel: "Irrita.", uso: "Limpieza." },
        "Amoniaco": { desc: "Gas de olor fuerte.", piel: "Quema.", uso: "Limpieza profunda." },
        "Glicerina": { desc: "Liquido viscoso dulce.", piel: "Humecta.", uso: "Jabones y explosivos." },
        "Permanganato de Potasio": { desc: "Oxidante purpura.", piel: "Mancha fuerte.", uso: "Tratamiento de agua." },
        "Acido Sulfurico": { desc: "Acido mineral fuerte.", piel: "Carboniza.", uso: "Industria quimica." },
        "Nafta": { desc: "Hidrocarburo inflamable.", piel: "Reseca.", uso: "Motores." },
        "Sosa Caustica": { desc: "Base fuerte corrosiva.", piel: "Saponifica la grasa.", uso: "Destape de ca√±erias." },
        "Aluminio": { desc: "Metal ligero.", piel: "Seguro.", uso: "Envases." }
    };

    const REACCIONES = [
        { items: ["Salitre", "Azufre", "Carbon"], nombre: "Polvora Negra", peligro: "ALTO", util: true, desc: "Has creado polvora estable. Un propelente clasico.", uso: "Municion y voladuras controladas." },
        { items: ["Polvora", "Fuego"], nombre: "Deflagracion Explosiva", peligro: "MORTAL", util: true, desc: "¬°KABOOM! La polvora se expande violentamente con fuego.", uso: "Demolicion de rocas en mineria." },
        { items: ["Litio", "Agua"], nombre: "Estallido de Hidrogeno", peligro: "EXTREMO", util: true, desc: "El litio flota, burbujea violentamente y explota con un destello.", uso: "Generacion rapida de energia." },
        { items: ["Acido Fluorhidrico", "Hierro"], nombre: "Desecho Corrosivo", peligro: "ALTO", util: false, desc: "El hierro se vuelve una masa negra inservible.", uso: "Ninguno." },
        { items: ["Agua", "Sodio Metalico"], nombre: "Explosion de Sodio", peligro: "MORTAL", util: true, desc: "Reaccion violenta que genera una bola de fuego blanca.", uso: "Demostraciones de reactividad." },
        { items: ["Lavandina", "Amoniaco"], nombre: "Gas Toxico", peligro: "MORTAL", util: true, desc: "Se libera gas cloramina mortal.", uso: "Arma quimica (Prohibido)." },
        { items: ["Glicerina", "Permanganato de Potasio"], nombre: "Fuego Purpura", peligro: "MEDIO", util: true, desc: "Ignicion retardada de alta temperatura.", uso: "Supervivencia y se√±ales." },
        { items: ["Vinagre", "Bicarbonato de Sodio"], nombre: "Dioxido de Carbono", peligro: "NULO", util: true, desc: "Efervescencia segura.", uso: "Extintores caseros." }
    ];

    let seleccionados = [];
    let bitacora = JSON.parse(localStorage.getItem('bitacora_v8')) || [];

    function setup() {
        const inv = document.getElementById('inventory');
        Object.keys(QUIMICOS).sort().forEach(n => {
            const d = document.createElement('div');
            d.className = 'item';
            d.id = `item-${n}`;
            d.innerHTML = `<span>${n}</span> <button class="q-btn" onclick="info(event, '${n}')">?</button>`;
            d.onclick = () => toggle(n, d);
            inv.appendChild(d);
        });
        updateBitacora();
    }

    function toggle(n, el) {
        if (seleccionados.includes(n)) {
            seleccionados = seleccionados.filter(x => x !== n);
            el.classList.remove('active');
        } else {
            if (seleccionados.length >= 3) return;
            seleccionados.push(n);
            el.classList.add('active');
        }
        document.getElementById('selection-text').innerText = seleccionados.length ? seleccionados.join(' + ') : "Selecciona elementos...";
        document.getElementById('mix-trigger').disabled = seleccionados.length < 2;
    }

    function simulate() {
        const box = document.getElementById('result-display');
        const match = REACCIONES.find(r => r.items.length === seleccionados.length && r.items.every(i => seleccionados.includes(i)));
        
        box.style.display = "block";
        if (match) {
            const pColor = match.peligro === "MORTAL" ? "var(--danger)" : (match.peligro === "ALTO" ? "var(--warning)" : "var(--safe)");
            box.style.borderLeftColor = pColor;
            box.innerHTML = `
                <div class="danger-tag" style="background:${pColor}; color:white">PELIGRO: ${match.peligro}</div>
                <h3 style="margin:0">${match.nombre}</h3>
                <p>${match.desc}</p>
                <small><b>Uso:</b> ${match.uso}</small>
                ${match.util ? `<br><button onclick="save('${match.nombre}', '${match.uso}')" style="margin-top:10px; border:none; background:var(--accent); color:white; padding:4px 8px; border-radius:4px; font-size:9px;">üíæ ARCHIVAR</button>` : `<p style="color:var(--danger); font-size:9px;">‚ö†Ô∏è No se archiva: Resultado in√∫til.</p>`}
            `;
        } else {
            box.innerHTML = `<h3>Mezcla Desconocida</h3><p>No hay datos. Podria ser estable o una explosion silenciosa.</p>`;
        }
    }

    function save(nom, uso) {
        if (!bitacora.some(b => b.nom === nom)) {
            bitacora.push({ nom, uso });
            localStorage.setItem('bitacora_v8', JSON.stringify(bitacora));
            updateBitacora();
        }
    }

    function updateBitacora() {
        const list = document.getElementById('saved-list');
        list.innerHTML = bitacora.length ? bitacora.map(b => `
            <div class="recipe-card">
                <b>${b.nom}</b><br><small>Uso: ${b.uso}</small>
            </div>
        `).join('') : "<small style='opacity:0.5'>Sin descubrimientos utiles.</small>";
    }

    function info(e, n) {
        e.stopPropagation();
        const d = QUIMICOS[n];
        document.getElementById('modal-body').innerHTML = `
            <h2 style="color:var(--accent); margin:0">${n}</h2>
            <p>${d.desc}</p>
            <p>‚ö†Ô∏è <b>Piel:</b> ${d.piel}</p>
            <p>üõ†Ô∏è <b>Uso:</b> ${d.uso}</p>
            <button class="close-btn" onclick="closeM()">CERRAR</button>
        `;
        document.getElementById('modal').style.display = 'flex';
    }

    function closeM() { document.getElementById('modal').style.display = 'none'; }

    function clearLab() {
        seleccionados = [];
        document.querySelectorAll('.item').forEach(i => i.classList.remove('active'));
        document.getElementById('result-display').style.display = "none";
        document.getElementById('mix-trigger').disabled = true;
    }

    function filter() {
        const q = document.getElementById('search').value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        document.querySelectorAll('.item').forEach(el => {
            el.classList.toggle('hide', !el.id.toLowerCase().includes(q));
        });
    }

    setup();
</script>
</body>
</html>
