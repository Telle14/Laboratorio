<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lab Master V9 - Interactive Station</title>
    <style>
        :root {
            --bg: #010409; --card: #0d1117; --border: #30363d;
            --accent: #58a6ff; --danger: #f85149; --warning: #d29922;
            --safe: #3fb950; --info: #bc8cff; --text: #c9d1d9;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 10px; font-size: 11px; }
        
        .container { max-width: 600px; margin: auto; display: flex; flex-direction: column; gap: 8px; }
        h1 { font-size: 16px; text-align: center; color: var(--accent); margin: 5px 0; letter-spacing: 2px; }

        .search-box { position: sticky; top: 0; z-index: 100; background: var(--bg); padding: 5px 0; }
        #search { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: white; font-size: 13px; }

        .shelf { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 8px; max-height: 250px; overflow-y: auto; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .item { background: #161b22; border: 1px solid var(--border); padding: 8px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s; }
        .item.active { border-color: var(--accent); background: #1f2937; transform: scale(0.98); }
        .item.hide { display: none; }

        .q-btn { width: 20px; height: 20px; border-radius: 50%; border: 1px solid var(--info); color: var(--info); background: none; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 10px; cursor: pointer; }

        .reactor { background: var(--card); border: 2px dashed var(--border); border-radius: 12px; padding: 15px; text-align: center; }
        .mix-btn { width: 100%; padding: 12px; border-radius: 8px; border: none; background: var(--safe); color: white; font-weight: bold; font-size: 14px; cursor: pointer; box-shadow: 0 4px 0 #238636; }
        .mix-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #238636; }
        .mix-btn:disabled { background: #21262d; color: #484f58; box-shadow: none; }

        .result-pane { display: none; background: #161b22; border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-top: 8px; border-left: 4px solid var(--accent); }

        .history { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 10px; }
        .recipe-card { background: #010409; border-radius: 6px; padding: 10px; margin-bottom: 8px; border-left: 3px solid var(--safe); display: flex; justify-content: space-between; align-items: center; }
        
        .btn-action { border: none; border-radius: 4px; padding: 5px 8px; font-size: 9px; cursor: pointer; font-weight: bold; }
        .btn-load { background: var(--accent); color: white; margin-right: 5px; }
        .btn-save-recipe { background: var(--safe); color: white; margin-top: 10px; width: 100%; padding: 8px; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-content { background: var(--card); border: 1px solid var(--accent); border-radius: 12px; padding: 20px; width: 100%; max-height: 80%; overflow-y: auto; text-align: center; }
        .close-btn { background: var(--danger); color: white; border: none; padding: 10px; border-radius: 6px; width: 100%; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>CHEM-LAB Master V9</h1>

    <div class="search-box">
        <input type="text" id="search" placeholder="Escribe para buscar..." onkeyup="filter()">
    </div>

    <div class="shelf">
        <div class="grid" id="inventory"></div>
    </div>

    <div class="reactor">
        <div id="selection-text" style="margin-bottom: 8px; color: #8b949e;">Mesa vac칤a...</div>
        <button class="mix-btn" id="mix-trigger" disabled onclick="simulate()">MEZCLAR AHORA</button>
        <button onclick="clearLab()" style="background:none; border:none; color:var(--danger); font-size:9px; margin-top:10px;">RESETEAR MESA</button>
    </div>

    <div id="result-display" class="result-pane"></div>

    <div class="history">
        <span style="font-weight:bold; color:var(--info); font-size:10px;">游늾 RECETARIO GUARDADO</span>
        <div id="saved-list" style="margin-top:8px;"></div>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-content" id="modal-body"></div>
</div>

<script>
    const QUIMICOS = {
        "Acido Fluorhidrico": { d: "L칤quido ultra-corrosivo.", u: "Grabado de cristales." },
        "Hierro": { d: "Metal s칩lido.", u: "Construcci칩n." },
        "Agua": { d: "Solvente vital.", u: "Refrigerante." },
        "Fuego": { d: "Energ칤a t칠rmica.", u: "Iniciador." },
        "Sodio Metalico": { d: "Metal reactivo.", u: "S칤ntesis." },
        "Litio": { d: "Metal ligero.", u: "Bater칤as." },
        "Salitre": { d: "Oxidante potente.", u: "P칩lvora." },
        "Azufre": { d: "No metal inflamable.", u: "Vulcanizaci칩n." },
        "Carbon": { d: "Base org치nica.", u: "Combustible." },
        "Polvora": { d: "Mezcla explosiva.", u: "Pirotecnia." },
        "Lavandina": { d: "Cloro l칤quido.", u: "Limpieza." },
        "Amoniaco": { d: "Gas fuerte.", u: "Fertilizante." },
        "Glicerina": { d: "Viscoso dulce.", u: "Explosivos." },
        "Permanganato de Potasio": { d: "Oxidante p칰rpura.", u: "Filtros." },
        "Acido Sulfurico": { d: "츼cido mineral.", u: "Bater칤as." },
        "Sosa Caustica": { d: "Base fuerte.", u: "Destape." },
        "Aluminio": { d: "Metal ligero.", u: "Envases." }
    };

    const REACCIONES = [
        { items: ["Salitre", "Azufre", "Carbon"], nombre: "Polvora Negra", peligro: "ALTO", util: true, desc: "Mezcla propelente cl치sica.", uso: "Demolici칩n y cohetes." },
        { items: ["Polvora", "Fuego"], nombre: "Gran Explosion", peligro: "MORTAL", util: true, desc: "춰KABOOM! Expansi칩n t칠rmica masiva.", uso: "Miner칤a pesada." },
        { items: ["Litio", "Agua"], nombre: "Estallido de Hidrogeno", peligro: "EXTREMO", util: true, desc: "Reacci칩n efervescente que termina en estallido.", uso: "Celdas de combustible." },
        { items: ["Agua", "Sodio Metalico"], nombre: "Bola de Fuego", peligro: "MORTAL", util: true, desc: "Explosi칩n blanca instant치nea.", uso: "Reactividad pura." },
        { items: ["Lavandina", "Amoniaco"], nombre: "Gas Cloramina", peligro: "MORTAL", util: true, desc: "Gas asfixiante letal.", uso: "Uso industrial restringido." },
        { items: ["Glicerina", "Permanganato de Potasio"], nombre: "Fuego Purpura", peligro: "MEDIO", util: true, desc: "Fuego qu칤mico espont치neo.", uso: "Se침alizaci칩n." },
        { items: ["Acido Fluorhidrico", "Hierro"], nombre: "Desecho Corrosivo", peligro: "ALTO", util: false, desc: "Masa negra sin utilidad.", uso: "Ninguno." }
    ];

    let seleccionados = [];
    let recetas = JSON.parse(localStorage.getItem('recetas_v9')) || [];

    function setup() {
        const inv = document.getElementById('inventory');
        Object.keys(QUIMICOS).sort().forEach(n => {
            const d = document.createElement('div');
            d.className = 'item';
            d.id = `item-${n.replace(/ /g, "_")}`;
            d.innerHTML = `<span>${n}</span> <button class="q-btn" onclick="info(event, '${n}')">?</button>`;
            d.onclick = () => toggle(n, d);
            inv.appendChild(d);
        });
        updateSavedUI();
    }

    function toggle(n, el) {
        if (seleccionados.includes(n)) {
            seleccionados = seleccionados.filter(x => x !== n);
            el.classList.remove('active');
        } else {
            if (seleccionados.length >= 3) return;
            seleccionados.push(n);
            el.classList.add('active');
        }
        document.getElementById('selection-text').innerText = seleccionados.length ? seleccionados.join(' + ') : "Mesa vac칤a...";
        document.getElementById('mix-trigger').disabled = seleccionados.length < 2;
    }

    function simulate() {
        const box = document.getElementById('result-display');
        const match = REACCIONES.find(r => r.items.length === seleccionados.length && r.items.every(i => seleccionados.includes(i)));
        
        box.style.display = "block";
        if (match) {
            box.innerHTML = `
                <h3 style="margin:0">${match.nombre}</h3>
                <p>${match.desc}</p>
                ${match.util ? `<button class="btn-save-recipe" onclick="saveRecipe('${match.nombre}')">游 GUARDAR RECETA</button>` : `<p style="color:var(--danger)">丘멆잺 Resultado in칰til, no se puede guardar.</p>`}
            `;
        } else {
            box.innerHTML = `<h3>Mezcla Desconocida</h3><p>Sin datos qu칤micos registrados.</p>`;
        }
    }

    function saveRecipe(nombre) {
        const r = REACCIONES.find(re => re.nombre === nombre);
        if (!recetas.some(x => x.nombre === nombre)) {
            recetas.push({ nombre: r.nombre, ingredientes: r.items, uso: r.uso });
            localStorage.setItem('recetas_v9', JSON.stringify(recetas));
            updateSavedUI();
        }
    }

    function updateSavedUI() {
        const list = document.getElementById('saved-list');
        list.innerHTML = recetas.map(r => `
            <div class="recipe-card">
                <div><b>${r.nombre}</b></div>
                <div>
                    <button class="btn-action btn-load" onclick="loadRecipe('${r.nombre}')">CARGAR</button>
                    <button class="q-btn" style="display:inline-flex" onclick="showRecipeInfo('${r.nombre}')">?</button>
                </div>
            </div>
        `).join('');
    }

    function loadRecipe(nombre) {
        clearLab();
        const r = recetas.find(x => x.nombre === nombre);
        r.ingredientes.forEach(ing => {
            const el = document.getElementById(`item-${ing.replace(/ /g, "_")}`);
            if (el) toggle(ing, el);
        });
    }

    function showRecipeInfo(nombre) {
        const r = recetas.find(x => x.nombre === nombre);
        document.getElementById('modal-body').innerHTML = `
            <h3>RECETA: ${r.nombre}</h3>
            <p><b>Ingredientes necesarios:</b><br>${r.ingredientes.join(' + ')}</p>
            <p><i>Uso: ${r.uso}</i></p>
            <button class="close-btn" onclick="closeM()">ENTENDIDO</button>
        `;
        document.getElementById('modal').style.display = 'flex';
    }

    function info(e, n) {
        e.stopPropagation();
        const d = QUIMICOS[n];
        document.getElementById('modal-body').innerHTML = `
            <h2>${n}</h2>
            <p>${d.d}</p>
            <p><b>Uso principal:</b> ${d.u}</p>
            <button class="close-btn" onclick="closeM()">CERRAR</button>
        `;
        document.getElementById('modal').style.display = 'flex';
    }

    function closeM() { document.getElementById('modal').style.display = 'none'; }

    function clearLab() {
        seleccionados = [];
        document.querySelectorAll('.item').forEach(i => i.classList.remove('active'));
        document.getElementById('result-display').style.display = "none";
        document.getElementById('mix-trigger').disabled = true;
        document.getElementById('selection-text').innerText = "Mesa vac칤a...";
    }

    function filter() {
        const q = document.getElementById('search').value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        document.querySelectorAll('.item').forEach(el => {
            el.classList.toggle('hide', !el.textContent.toLowerCase().includes(q));
        });
    }

    setup();
</script>
</body>
</html>
